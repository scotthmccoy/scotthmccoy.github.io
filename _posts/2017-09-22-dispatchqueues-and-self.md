---
layout: post
title: DispatchQueues and self
date: '2017-09-22T11:55:00.006-07:00'
author: Scott McCoy
tags: 
modified_time: '2017-09-22T11:58:43.124-07:00'
blogger_id: tag:blogger.com,1999:blog-250956833460526415.post-2547054681503180742
blogger_orig_url: https://scotthmccoy.blogspot.com/2017/09/dispatchqueues-and-self.html
---

<div class="p1"><span class="s1"><b>You don't need to use unowned self or weak self on every closure, unless the closure itself is retained. In the following example self is retained until the closure completes, then the deinit fires.</b></span><br /><span class="s1"><b><br /></b></span></div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; </span><span class="s1">@IBAction</span> <span class="s1">func</span> eventLabelPressed(<span class="s1">_</span> sender: <span class="s1">Any</span>) {</div><div class="p2"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;</span></div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="s2">OXMLog</span>.<span class="s3">whereAmI</span>()</div><div class="p2"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;</span></div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="s1">if</span> <span class="s1">let</span> btn = sender <span class="s1">as</span>? <span class="s4">UIButton</span> {</div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>btn.<span class="s4">isEnabled</span> = <span class="s1">false</span></div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span>}</div><div class="p2"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;</span></div><div class="p2"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;</span></div><div class="p3"><span class="s5"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="s2">OXMLog</span><span class="s5">.</span><span class="s3">info</span><span class="s5">(</span>"Before myFunc"<span class="s5">)</span></div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="s3">myFunc</span>()</div><div class="p3"><span class="s5"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span></span><span class="s2">OXMLog</span><span class="s5">.</span><span class="s3">info</span><span class="s5">(</span>"After myFunc"<span class="s5">)</span></div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; </span>}</div><div class="p2"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp;</span></div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; </span><span class="s1">func</span> myFunc() {</div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="s1">class</span> MyObject {</div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="s1">let</span> message = <span class="s6">"Foo"</span></div><div class="p2"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="s1">func</span> doThing() {</div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="s4">DispatchQueue</span>.<span class="s4">main</span>.<span class="s7">async</span> {</div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="s2">OXMLog</span>.<span class="s3">info</span>(<span class="s1">self</span>.<span class="s2">message</span>)</div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>}</div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>}</div><div class="p2"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="s1">deinit</span> {</div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="s2">OXMLog</span>.<span class="s3">whereAmI</span>()</div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>}</div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span>}</div><div class="p2"><span class="Apple-converted-space">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;</span></div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="s1">let</span> obj = <span class="s2">MyObject</span>()</div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span>obj.<span class="s3">doThing</span>()</div><div class="p1"><span class="s1">    <style type="text/css">p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; color: #000000; background-color: #ffffff} p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; color: #000000; background-color: #ffffff; min-height: 13.0px} p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; color: #d12f1b; background-color: #ffffff} span.s1 {color: #ba2da2} span.s2 {color: #4f8187} span.s3 {color: #31595d} span.s4 {color: #703daa} span.s5 {color: #000000} span.s6 {color: #d12f1b} span.s7 {color: #3e1e81} </style>                                 </span></div><div class="p1"><span class="Apple-converted-space">&nbsp; &nbsp;&nbsp;</span>}</div><div class="p1"><span class="s1"><b><br /></b></span></div><div class="p1"><span class="s1"><b><br /></b></span></div><div class="p1"><span class="s1"><b><br /></b></span></div><div class="p1"><span class="s1"><b><br /></b></span></div><div class="p1"><span class="s1"><b><span style="color: black; font-family: inherit;">Result:</span></b></span><br /><span class="s1"><span class="s1"><b>INFO [MAIN] 09-22 11:53:56:4560 BannerViewController.swift eventLabelPressed [Line 118]: Before myFunc</b></span></span><br /><span class="s1"><span class="s1"><b>INFO [MAIN] 09-22 11:53:56:4570 BannerViewController.swift eventLabelPressed [Line 120]: After myFunc</b></span></span><br /><span class="s1"><span class="s1"><b>INFO [MAIN] 09-22 11:53:56:4570 BannerViewController.swift doThing() [Line 129]: Foo</b></span></span><br /><span class="s1"><span class="s1"><b>INFO [MAIN] 09-22 11:53:56:4580 BannerViewController.swift deinit [Line 134]:<span class="Apple-converted-space">&nbsp;</span></b></span></span></div><blockquote class="tr_bq"><blockquote class="tr_bq"><br /></blockquote></blockquote><style type="text/css">p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; color: #000000} span.s1 {font-variant-ligatures: no-common-ligatures} </style>     